# HTTPS server 
server {
  listen 443      ssl http2 default_server;
  listen [::]:443 ssl http2 default_server;
  server_name  ~^(www\.)?(?<domain>.+)$;
  root html;
  index index.html;

#           Certificates
##################################################
  include certs.conf;
  include tls.conf;
  include headers.conf;
  include destroy-cookie.conf;
  # phase: right before ssl handshake
  # set globals for server rewrites context
#################################################
  set_by_lua_block $exAuth { return os.getenv("EXIST_AUTH") }
  set_by_lua_block $eXistHome { return os.getenv("EXIST_HOME") }
  set_by_lua_block $eXistDataDir { return os.getenv("EXIST_DATA_DIR") }
  # set_by_lua_block $twitterAuth { return  os.getenv("TWITTER_AUTH") }
  set $fsAppsPath "$eXistHome/$eXistDataDir/fs/db/apps/$domain";
  set $fsDataPath "$eXistHome/$eXistDataDir/fs/db/data/$domain";
  # before locations insert server-rewrite phase
  include rewrites.conf;
  include locations.conf;
  # location / {
  # }
}
